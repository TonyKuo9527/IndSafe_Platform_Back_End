import{r as y}from"./request.60bf0c1b.js";import{_ as G,b as d,w as t,f as a,o as r,a as e,g as b,d as n,c as M,r as w,F as x,e as c,t as h}from"./index.ee0f6373.js";const O={name:"AlertList",data(){return{data:[],pages:0,page:1,size:5,imageModel:!1,deleteModel:!1,item:{},imagePath:"",rtsp:"",buffer:!1,toasts:[]}},mounted(){this.checkJWT()},methods:{checkJWT(){if(!this.$store.state.jwt){this.toasts.push({title:"Error",content:"\u767B\u5165\u91D1\u9470\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165!"}),this.$router.push("/dashboard");return}y({method:"POST",url:"/auth/checkJWT",headers:{authorization:this.$store.state.jwt}}).then(i=>{i.data.status?this.init():(this.toasts.push({title:"Error",content:"\u767B\u5165\u91D1\u9470\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165!"}),this.$router.push("/dashboard"))}).catch(i=>{console.log(i)})},init(){this.pages=0,this.page=1,this.size=5,y({method:"GET",url:"/alert/"+this.$store.state.userToken}).then(i=>{let o=i.data;switch(o.status){case 1:let k=[];o.data.length>=25?this.size=15:this.size=5,o.data.forEach((u,l)=>{switch(u.index=l+1,u.type){case 1:u.type="Not wearing hat";break;case 0:u.type="Not using hook";break;case 2:u.type="Didn't wear vest";break;case 3:u.type="Not use chinstrap";break;default:u.type="\u672A\u77E5";break}k.push(u)}),this.data=k,this.data.length/this.size>1?this.pages=Math.ceil(this.data.length/this.size):this.pages=1;break;case 0:this.toasts.push({title:"Error",content:"\u7CFB\u7D71\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B"});break;case 102:this.toasts.push({title:"Error",content:"token\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165"});break}}).catch(i=>{console.log(i)})},showImageModel(i){this.item=i,this.imageModel=!0,this.imagePath="/image/"+i.image,this.rtsp="https://rtsp.ap.ngrok.io/video_feed/"+i.cameraID},showDeleteModel(i){this.item=i,this.deleteModel=!0},deleteAlert(){if(this.buffer)return;this.buffer=!0;let i={image:this.item.image};y({method:"DELETE",url:"/alert",data:i,headers:{authorization:this.$store.state.jwt}}).then(o=>{switch(o.data.status){case 1:this.toasts.push({title:"Success",content:"\u522A\u9664\u6210\u529F!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 0:this.toasts.push({title:"Error",content:"\u7CFB\u7D71\u767C\u751F\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 101:this.toasts.push({title:"Error",content:"\u8CC7\u6599\u683C\u5F0F\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 102:this.toasts.push({title:"Error",content:"\u8B66\u5831\u4E0D\u5B58\u5728\uFF0C\u8ACB\u91CD\u65B0\u64CD\u4F5C!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 110:this.toasts.push({title:"Error",content:"\u8CC7\u6599\u4E2D\u5B58\u5728\u9055\u898F\u7684\u7279\u6B8A\u7B26\u865F!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 121:this.toasts.push({title:"Error",content:"JWT\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break}}).catch(o=>{this.toasts.push({title:"Error",content:"\u7CFB\u7D71\u767C\u751F\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT()})},reload(){console.log("reload"),window.location.reload()}}},K=b("br",null,null,-1),Q={class:"clearfix"},Y={class:"clearfix"},Z={class:"me-auto fw-bold"};function $(i,o,k,u,l,f){const p=a("CIcon"),_=a("CButton"),m=a("CTableHeaderCell"),z=a("CTableRow"),J=a("CTableHead"),C=a("CTableDataCell"),W=a("CTableBody"),P=a("CTable"),F=a("CPaginationItem"),H=a("CPagination"),L=a("CCardBody"),v=a("CModalTitle"),I=a("CModalHeader"),g=a("CFormLabel"),T=a("CFormInput"),D=a("CImage"),A=a("CModalBody"),E=a("CModalFooter"),B=a("CModal"),N=a("CToastHeader"),R=a("CToastBody"),S=a("CToast"),U=a("CToaster"),j=a("CCard"),X=a("CRow"),q=a("CContainer");return r(),d(q,null,{default:t(()=>[e(X,null,{default:t(()=>[e(j,null,{default:t(()=>[e(L,null,{default:t(()=>[b("h2",null,[n("Alert List "),e(_,{onClick:o[0]||(o[0]=s=>f.init())},{default:t(()=>[e(p,{name:"cil-sync"}),n(" Update ")]),_:1})]),e(P,{align:"middle",responsive:""},{default:t(()=>[e(J,null,{default:t(()=>[e(z,null,{default:t(()=>[e(m,{scope:"col",class:"w-20"},{default:t(()=>[n("Type")]),_:1}),e(m,{scope:"col",class:"w-20"},{default:t(()=>[n("CameraID")]),_:1}),e(m,{scope:"col",class:"w-20"},{default:t(()=>[n("Timestamp")]),_:1}),e(m,{scope:"col",class:"w-20"},{default:t(()=>[n("Description")]),_:1}),e(m,{scope:"col",class:"w-20"})]),_:1})]),_:1}),e(W,null,{default:t(()=>[(r(!0),M(x,null,w(l.data,s=>(r(),d(z,{key:s.index},{default:t(()=>[s.index<=l.page*l.size&&s.index>(l.page-1)*l.size?(r(),d(C,{key:0},{default:t(()=>[n(h(s.type),1)]),_:2},1024)):c("",!0),s.index<=l.page*l.size&&s.index>(l.page-1)*l.size?(r(),d(C,{key:1},{default:t(()=>[n(h(s.cameraID),1)]),_:2},1024)):c("",!0),s.index<=l.page*l.size&&s.index>(l.page-1)*l.size?(r(),d(C,{key:2},{default:t(()=>[n(h(s.timestamp),1)]),_:2},1024)):c("",!0),s.index<=l.page*l.size&&s.index>(l.page-1)*l.size?(r(),d(C,{key:3},{default:t(()=>[n(h(s.description),1)]),_:2},1024)):c("",!0),s.index<=l.page*l.size&&s.index>(l.page-1)*l.size?(r(),d(C,{key:4},{default:t(()=>[e(_,{onClick:V=>f.showImageModel(s)},{default:t(()=>[e(p,{name:"cil-image"})]),_:2},1032,["onClick"]),i.$store.state.userType==="admin"?(r(),d(_,{key:0,onClick:V=>f.showDeleteModel(s)},{default:t(()=>[e(p,{name:"cil-trash"})]),_:2},1032,["onClick"])):c("",!0)]),_:2},1024)):c("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),l.data.length>0?(r(),d(H,{key:0,align:"end","aria-label":"Page navigation example"},{default:t(()=>[(r(!0),M(x,null,w(l.pages,s=>(r(),d(F,{key:s.index,active:l.page===s,onClick:V=>l.page=s},{default:t(()=>[n(h(s),1)]),_:2},1032,["active","onClick"]))),128))]),_:1})):c("",!0)]),_:1}),e(B,{alignment:"center",size:"lg",visible:l.imageModel,onClose:o[5]||(o[5]=()=>{l.imageModel=!1,f.reload()})},{default:t(()=>[e(I,null,{default:t(()=>[e(v,null,{default:t(()=>[n("Alert")]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(g,null,{default:t(()=>[n("Type")]),_:1}),e(T,{id:"Type",modelValue:l.item.type,"onUpdate:modelValue":o[1]||(o[1]=s=>l.item.type=s),disabled:""},null,8,["modelValue"]),e(g,null,{default:t(()=>[n("CameraID")]),_:1}),e(T,{id:"CameraID",modelValue:l.item.cameraID,"onUpdate:modelValue":o[2]||(o[2]=s=>l.item.cameraID=s),disabled:""},null,8,["modelValue"]),e(g,null,{default:t(()=>[n("Timestamp")]),_:1}),e(T,{id:"Timestamp",modelValue:l.item.timestamp,"onUpdate:modelValue":o[3]||(o[3]=s=>l.item.timestamp=s),disabled:""},null,8,["modelValue"]),K,e(g,null,{default:t(()=>[n("Image")]),_:1}),b("div",Q,[e(D,{fluid:"",rounded:"",src:l.imagePath},null,8,["src"])]),e(g,null,{default:t(()=>[n("RTSP Live")]),_:1}),b("div",Y,[e(D,{fluid:"",rounded:"",src:l.rtsp},null,8,["src"])])]),_:1}),e(E,null,{default:t(()=>[e(_,{color:"secondary",onClick:o[4]||(o[4]=()=>{l.imageModel=!1,f.reload()})},{default:t(()=>[e(p,{name:"cil-X"}),n(" Close ")]),_:1})]),_:1})]),_:1},8,["visible"]),e(B,{size:"sm",alignment:"center",visible:l.deleteModel,onClose:o[8]||(o[8]=()=>{l.deleteModel=!1})},{default:t(()=>[e(I,null,{default:t(()=>[e(v,null,{default:t(()=>[n("Delete Alert")]),_:1})]),_:1}),e(E,null,{default:t(()=>[e(_,{color:"danger",onClick:o[6]||(o[6]=s=>f.deleteAlert()),disabled:l.buffer},{default:t(()=>[e(p,{name:"cil-trash"}),n("Delete")]),_:1},8,["disabled"]),e(_,{color:"secondary",onClick:o[7]||(o[7]=()=>{l.deleteModel=!1})},{default:t(()=>[e(p,{name:"cil-X"}),n(" Close ")]),_:1})]),_:1})]),_:1},8,["visible"]),e(U,{placement:"top-end"},{default:t(()=>[(r(!0),M(x,null,w(l.toasts,s=>(r(),d(S,{key:s.index,delay:3e3},{default:t(()=>[e(N,{closeButton:""},{default:t(()=>[b("span",Z,h(s.title),1)]),_:2},1024),e(R,null,{default:t(()=>[n(h(s.content),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})}const le=G(O,[["render",$]]);export{le as default};

import{r as k}from"./request.60bf0c1b.js";import{_ as q,b as c,w as t,f as l,o as i,a as o,g as x,d as a,c as m,r as T,F as y,e as u,t as d}from"./index.ee0f6373.js";const G={name:"NotifyManagement",data(){return{data:[],pages:0,page:1,size:5,deleteModel:!1,item:{},buffer:!1,toasts:[]}},mounted(){this.checkJWT()},methods:{checkJWT(){if(!this.$store.state.jwt){this.toasts.push({title:"Error",content:"\u767B\u5165\u91D1\u9470\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165!"}),this.$router.push("/dashboard");return}k({method:"POST",url:"/auth/checkJWT",headers:{authorization:this.$store.state.jwt}}).then(r=>{r.data.status?this.init():(this.toasts.push({title:"Error",content:"\u767B\u5165\u91D1\u9470\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165!"}),this.$router.push("/dashboard"))}).catch(r=>{console.log(r)})},init(){this.pages=0,this.page=1,this.size=5,k({method:"GET",url:"/notify"}).then(r=>{let n=r.data;switch(n.status){case 1:let _=[];n.data.length>=25?this.size=15:this.size=5,n.data.forEach((g,e)=>{g.index=e+1,_.push(g)}),this.data=_,this.data.length/this.size>1?this.pages=Math.ceil(this.data.length/this.size):this.pages=1;break;case 0:this.toasts.push({title:"Error",content:"\u7CFB\u7D71\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B"});break}}).catch(r=>{console.log(r)})},showDeleteModel(r){this.item=r,this.deleteModel=!0},Cancel(){if(this.buffer)return;this.buffer=!0;const r={token:this.item.token};k({method:"DELETE",url:"/notify",data:r,headers:{authorization:this.$store.state.jwt}}).then(n=>{switch(n.data.status){case 1:this.toasts.push({title:"Success",content:"\u53D6\u6D88\u6210\u529F!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 0:this.toasts.push({title:"Error",content:"\u7CFB\u7D71\u767C\u751F\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 101:this.toasts.push({title:"Error",content:"\u8CC7\u6599\u683C\u5F0F\u932F\u8AA4\uFF0C\u8ACB\u8207\u7BA1\u7406\u8005\u806F\u7E6B!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 102:this.toasts.push({title:"Error",content:"\u8A02\u95B1Token\u4E0D\u5B58\u5728\uFF0C\u8ACB\u91CD\u65B0\u64CD\u4F5C!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 110:this.toasts.push({title:"Error",content:"\u8CC7\u6599\u4E2D\u5B58\u5728\u9055\u898F\u7684\u7279\u6B8A\u7B26\u865F!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break;case 121:this.toasts.push({title:"Error",content:"JWT\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165!"}),this.deleteModel=!1,this.buffer=!1,this.checkJWT();break}}).catch(n=>{this.checkJWT()})}}},O={class:"me-auto fw-bold"};function U(r,n,_,g,e,b){const p=l("CIcon"),C=l("CButton"),h=l("CTableHeaderCell"),M=l("CTableRow"),w=l("CTableHead"),f=l("CTableDataCell"),z=l("CTableBody"),E=l("CTable"),B=l("CPaginationItem"),v=l("CPagination"),J=l("CCardBody"),W=l("CModalTitle"),N=l("CModalHeader"),H=l("CModalFooter"),D=l("CModal"),P=l("CToastHeader"),F=l("CToastBody"),I=l("CToast"),R=l("CToaster"),S=l("CCard"),V=l("CRow"),j=l("CContainer");return i(),c(j,null,{default:t(()=>[o(V,null,{default:t(()=>[o(S,null,{default:t(()=>[o(J,null,{default:t(()=>[x("h2",null,[a("Notify Management "),o(C,{onClick:n[0]||(n[0]=s=>b.init())},{default:t(()=>[o(p,{name:"cil-sync"}),a(" Update ")]),_:1})]),o(E,{align:"middle",responsive:""},{default:t(()=>[o(w,null,{default:t(()=>[o(M,null,{default:t(()=>[o(h,{scope:"col",class:"w-25"},{default:t(()=>[a("Target")]),_:1}),o(h,{scope:"col",class:"w-25"},{default:t(()=>[a("Type")]),_:1}),o(h,{scope:"col",class:"w-25"},{default:t(()=>[a("ChannelName")]),_:1}),o(h,{scope:"col",class:"w-25"},{default:t(()=>[a("Subscriber")]),_:1}),o(h,{scope:"col",class:"w-25"})]),_:1})]),_:1}),o(z,null,{default:t(()=>[(i(!0),m(y,null,T(e.data,s=>(i(),c(M,{key:s.index},{default:t(()=>[s.index<=e.page*e.size&&s.index>(e.page-1)*e.size?(i(),c(f,{key:0},{default:t(()=>[a(d(s.target),1)]),_:2},1024)):u("",!0),s.index<=e.page*e.size&&s.index>(e.page-1)*e.size?(i(),c(f,{key:1},{default:t(()=>[a(d(s.type),1)]),_:2},1024)):u("",!0),s.index<=e.page*e.size&&s.index>(e.page-1)*e.size?(i(),c(f,{key:2},{default:t(()=>[a(d(s.channelName),1)]),_:2},1024)):u("",!0),s.index<=e.page*e.size&&s.index>(e.page-1)*e.size?(i(),c(f,{key:3},{default:t(()=>[a(d(s.name),1)]),_:2},1024)):u("",!0),s.index<=e.page*e.size&&s.index>(e.page-1)*e.size?(i(),c(f,{key:4},{default:t(()=>[o(C,{onClick:L=>b.showDeleteModel(s)},{default:t(()=>[o(p,{name:"cil-trash"})]),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),e.data.length>0?(i(),c(v,{key:0,align:"end","aria-label":"Page navigation example"},{default:t(()=>[(i(!0),m(y,null,T(e.pages,s=>(i(),c(B,{key:s.index,active:e.page===s,onClick:L=>e.page=s},{default:t(()=>[a(d(s),1)]),_:2},1032,["active","onClick"]))),128))]),_:1})):u("",!0)]),_:1}),o(D,{size:"sm",alignment:"center",visible:e.deleteModel,onClose:n[3]||(n[3]=()=>{e.deleteModel=!1})},{default:t(()=>[o(N,null,{default:t(()=>[o(W,null,{default:t(()=>[a("Cancel Notify")]),_:1})]),_:1}),o(H,null,{default:t(()=>[o(C,{color:"danger",onClick:n[1]||(n[1]=s=>b.Cancel()),disabled:e.buffer},{default:t(()=>[o(p,{name:"cil-trash"}),a(" Cancel")]),_:1},8,["disabled"]),o(C,{color:"secondary",onClick:n[2]||(n[2]=()=>{e.deleteModel=!1})},{default:t(()=>[o(p,{name:"cil-X"}),a(" Close ")]),_:1})]),_:1})]),_:1},8,["visible"]),o(R,{placement:"top-end"},{default:t(()=>[(i(!0),m(y,null,T(e.toasts,s=>(i(),c(I,{key:s.index,delay:3e3},{default:t(()=>[o(P,{closeButton:""},{default:t(()=>[x("span",O,d(s.title),1)]),_:2},1024),o(F,null,{default:t(()=>[a(d(s.content),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})}const K=q(G,[["render",U]]);export{K as default};
